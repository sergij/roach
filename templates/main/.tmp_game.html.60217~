{% extends "game_base.html" %}
{% block head %}
<script type="text/javascript">
function ping(ans) {
  $.post("/game/i_am_online/", { user: {{ user.id }} , answer: ans},
  function(data){
  	$("#gamers").text("")
  	if (data.length>0)
	{
		if (data[0].username == "war") {
		in_war(data[0].id);	
		}
		else {
		s = "<ul align=\"left\">Сейчас готовы играть:"
		for (i = 0; i < data.length; i++) {
			s += "<li align=\"left\">" + data[i].username + " Предложить <a href=\"attack\/" + data[i].id + "\/\">сыграть</a></li>"
		}
		s += "</ul>"
		
		$("#gamers").append(s);
		}
	}
  }
  , "json");
}
function in_war(id)
{
	if (confirm("Ты будеш играть в дурака?")) {
	parent.location='/game/attack/' + id + '/';
	}
else {
	ping("yes");
	}
}

$(document).ready(function(){
    $("#clck").click(function() {  ping() });
	$("#online").everyTime("5s",function(i) {
	    //ping users who are online
	    ping("no")
    }, 0);
    
	$("#online").oneTime(1, function() {
    ping("no")
    });
    
	$("#start").click(function() {
        $("#example_2").everyTime("5s", 'timer2', function(i) {
            $(this).text(5*i);
        }, 15);
    });
    
    $("#stop").click(function() {
        $("#example_2").stopTime('timer2');
    });
	
	//$("#hr").oneTime("60s", function() {
    //    $(this).hide(2500);
    //});
});
</script>

{% endblock %}

{% block title %}In Game{% endblock %}

{% block content %}

<h1 align='center'>Аa-а-а-а-а "Пиковая Дама"</h1>
<div align="center" id="gamers">

</div>
<div align="right" id="user">
{% if user.is_authenticated %}
<hidden id="online"/>
<p> Привет, {{ user.username }}</p>
{% endif %}
<button id="clck">Debug</button>
<form method="post" action="/accounts/index_login/">
{% csrf_token %}
<a href="/" id="hr">На главную</a>
</form>
</div>

{% endblock %}
